<!DOCTYPE html>
<html>
    <head>
        <title>Norn Browser Test</title>
        <meta name="viewport" content="initial-scale=1,maximum-scale=1,minimum-scale=1,width=device-width" />
        <meta charset="utf-8" />

        <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>

        <script src="../standalone/norn.js"></script>
    </head>
    <body>
        <app-root></app-root>
        <script type="text/javascript">
            let t = 0
            const {store, actions} = norn({
                list: {
                    initial: [],
                    $add: {
                        args: ["name"],
                        handler: (list, {name}) => {
                            const id = t
                            t += 1
                            return [...list, {name, id}]
                        },
                    },
                    // "groups.*": (list, action) => {
                    //     console.log("from list ", action.type)
                    //     return list
                    // }
                },
                groups: {
                    initial: {},
                    $add: {
                        args: ["id", "item"],
                        handler: (groups, {id, item}) => ({
                            ...groups,
                            [id]: item
                        }),
                    },
                    "list.$add": (_0, action) => {
                        console.log("from group", action.type)
                        return _0
                    }
                }
            })

            store.subscribe(
                (next) => console.log(next)
            )

            const e = React.createElement

            // const ClassThing = NornConnect.Class(store)(
            //     function ClassThing(props) {
            //         console.log(props)
            //         return e(
            //             "div",
            //             {},
            //             props.list.map(
            //                 item => e("div", null, `${item.name} (${item.id})`)
            //             )
            //         )
            //     }
            // )
            // const HookThing = NornConnect.Hook(store)(
            //     function HookThing(props) {
            //         return e("div", null, `groups: ${Object.keys(props.groups).join(", ")}`)
            //     }
            // )
            const HookThing = function HookThing(props) {
                const {groups} = norn.useStore(store)
                return e("div", null, `groups: ${Object.keys(groups).join(", ")}`)
            }

            function Main() {
                return e("div", null, e(HookThing))
            }
            ReactDOM.render(
                e(Main),
                document.querySelector("app-root")
            )
        </script>
    </body>
</html>
